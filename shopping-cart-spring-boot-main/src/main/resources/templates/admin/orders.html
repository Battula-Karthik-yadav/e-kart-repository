<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{base::layout(~{::section})}">
<head>
    <meta charset="ISO-8859-1">
    <title>All Orders - Admin Panel</title>
</head>
<body>
<section>
    <div class="container-fluid mt-4 px-4">
        <div class="row mb-3">
            <div class="col text-center">
                <h3 class="fw-semibold">All Orders</h3>
                <hr>
                <a href="/admin/" class="text-decoration-none"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</a>
            </div>
        </div>

        <!-- Alerts -->
        <div class="row">
            <div class="col">
                <th:block th:if="${session.succMsg}">
                    <div class="alert alert-success text-center fw-semibold">[[${session.succMsg}]]</div>
                    <th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
                </th:block>

                <th:block th:if="${session.errorMsg}">
                    <div class="alert alert-danger text-center fw-semibold">[[${session.errorMsg}]]</div>
                    <th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
                </th:block>
            </div>
        </div>

        <!-- Search -->
        <div class="row justify-content-start mb-3">
            <div class="col-md-4">
                <form action="/admin/search-order" method="get" class="d-flex gap-2">
                    <input type="text" class="form-control" name="orderId" placeholder="Enter Order ID">
                    <button class="btn btn-primary">Search</button>
                </form>
            </div>
        </div>

        <!-- Orders Table -->
        <div class="row">
            <div class="col">
                <div class="table-responsive shadow-sm">
                    <table class="table table-bordered align-middle">
                        <thead class="table-light text-center">
                        <tr>
                            <th>Order ID</th>
                            <th>Delivery Details</th>
                            <th>Date</th>
                            <th>Product</th>
                            <th>Pricing</th>
                            <th>Status</th>
                            <th>Update</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- If searched -->
                        <th:block th:if="${srch}">
                            <th:block th:if="${orderDtls!=null}">
                                <tr>
                                    <td>[[${orderDtls.orderId}]]</td>
                                    <td>
                                        <strong>Name:</strong> [[${orderDtls.orderAddress.firstName}]] [[${orderDtls.orderAddress.lastName}]]<br>
                                        <strong>Email:</strong> [[${orderDtls.orderAddress.email}]]<br>
                                        <strong>Mobile:</strong> [[${orderDtls.orderAddress.mobileNo}]]<br>
                                        <strong>Address:</strong> [[${orderDtls.orderAddress.address}]], [[${orderDtls.orderAddress.city}]], [[${orderDtls.orderAddress.state}]] - [[${orderDtls.orderAddress.pincode}]]
                                    </td>
                                    <td>[[${orderDtls.orderDate}]]</td>
                                    <td>[[${orderDtls.product.title}]]</td>
                                    <td>
                                        Quantity: [[${orderDtls.quantity}]]<br>
                                        Unit Price: ₹[[${orderDtls.price}]]<br>
                                        <strong>Total:</strong> ₹[[${orderDtls.quantity * orderDtls.price}]]
                                    </td>
                                    <td>[[${orderDtls.status}]]</td>
                                    <td>
                                        <form action="/admin/update-order-status" method="post" class="d-flex gap-2">
                                            <select class="form-select" name="st">
                                                <option>--select--</option>
                                                <option value="1">In Progress</option>
                                                <option value="2">Order Received</option>
                                                <option value="3">Product Packed</option>
                                                <option value="4">Out for Delivery</option>
                                                <option value="5">Delivered</option>
                                                <option value="6">Cancelled</option>
                                            </select>
                                            <input type="hidden" th:value="${orderDtls.id}" name="id">
                                            <button class="btn btn-sm btn-primary"
                                                    th:disabled="${orderDtls.status=='Cancelled' || orderDtls.status=='Delivered'}">Update</button>
                                        </form>
                                    </td>
                                </tr>
                            </th:block>
                            <th:block th:unless="${orderDtls!=null}">
                                <tr>
                                    <td colspan="7" class="text-center text-danger fw-bold fs-5">[[${errorMsg}]]</td>
                                </tr>
                            </th:block>
                        </th:block>

                        <!-- If all orders -->
                        <th:block th:unless="${srch}">
                            <tr th:each="o : ${orders}">
                                <td>[[${o.orderId}]]</td>
                                <td>
                                    <strong>Name:</strong> [[${o.orderAddress.firstName}]] [[${o.orderAddress.lastName}]]<br>
                                    <strong>Email:</strong> [[${o.orderAddress.email}]]<br>
                                    <strong>Mobile:</strong> [[${o.orderAddress.mobileNo}]]<br>
                                    <strong>Address:</strong> [[${o.orderAddress.address}]], [[${o.orderAddress.city}]], [[${o.orderAddress.state}]] - [[${o.orderAddress.pincode}]]
                                </td>
                                <td>[[${o.orderDate}]]</td>
                                <td>[[${o.product.title}]]</td>
                                <td>
                                    Quantity: [[${o.quantity}]]<br>
                                    Unit Price: ₹[[${o.price}]]<br>
                                    <strong>Total:</strong> ₹[[${o.quantity * o.price}]]
                                </td>
                                <td>[[${o.status}]]</td>
                                <td>
                                    <form action="/admin/update-order-status" method="post" class="d-flex gap-2">
                                        <select class="form-select" name="st">
                                            <option>--select--</option>
                                            <option value="1">In Progress</option>
                                            <option value="2">Order Received</option>
                                            <option value="3">Product Packed</option>
                                            <option value="4">Out for Delivery</option>
                                            <option value="5">Delivered</option>
                                            <option value="6">Cancelled</option>
                                        </select>
                                        <input type="hidden" th:value="${o.id}" name="id">
                                        <button class="btn btn-sm btn-primary"
                                                th:disabled="${o.status=='Cancelled' || o.status=='Delivered'}">Update</button>
                                    </form>
                                </td>
                            </tr>
                        </th:block>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <th:block th:if="${!srch}">
            <div class="row mt-3">
                <div class="col-md-4">
                    <p>Total Orders: <strong>[[${totalElements}]]</strong></p>
                </div>
                <div class="col-md-8">
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-end">
                            <li class="page-item" th:classappend="${isFirst} ? 'disabled':''">
                                <a class="page-link" th:href="@{'/admin/orders?pageNo='+${pageNo-1}}">&laquo;</a>
                            </li>

                            <li th:each="i:${#numbers.sequence(1,totalPages)}" class="page-item"
                                th:classappend="${pageNo+1==i}?'active':''">
                                <a class="page-link" th:href="@{'/admin/orders?pageNo='+${i-1}}">[[${i}]]</a>
                            </li>

                            <li class="page-item" th:classappend="${isLast} ? 'disabled':''">
                                <a class="page-link" th:href="@{'/admin/orders?pageNo='+${pageNo+1}}">&raquo;</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </th:block>
    </div>
</section>
</body>
</html>
