<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{base::layout(~{::section})}">
<head>
	<meta charset="ISO-8859-1">
    <title>All Products | Admin</title>
	<style>
	    .product-img {
	        width: 5px;
	        height: 5px;
	        object-fit: cover;
	        border-radius: 4px;
	        border: 1px solid #ccc;
	    }
	</style>

</head>
<body>
<section>
    <div class="container-fluid mt-4 p-4">

        <!-- Top Row with Title and Back Button -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="fw-bold">All Products</h4>
            <a href="/admin/" class="btn btn-outline-dark">
                <i class="fa-solid fa-arrow-left me-1"></i> Back
            </a>
        </div>
        <hr>

        <!-- Flash Messages -->
        <div th:if="${session.succMsg}" class="alert alert-success alert-dismissible fade show" role="alert">
            [[${session.succMsg}]]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            <th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
        </div>

        <div th:if="${session.errorMsg}" class="alert alert-danger alert-dismissible fade show" role="alert">
            [[${session.errorMsg}]]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            <th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
        </div>

        <!-- Search Bar -->
        <form action="/admin/products" method="get" class="mb-4">
            <div class="row g-2">
                <div class="col-md-4">
                    <input type="text" name="ch" class="form-control" placeholder="Search by title/category...">
                </div>
                <div class="col-auto">
                    <button class="btn btn-primary">
                        <i class="fa-solid fa-magnifying-glass me-1"></i> Search
                    </button>
                </div>
            </div>
        </form>

        <!-- Product Table -->
        <div class="table-responsive shadow-sm">
            <table class="table table-bordered table-hover align-middle text-center">
                <thead class="table-dark">
                <tr>
                    <th>Sl No</th>
                    <th>Image</th>
                    <th>Title</th>
                    <th>Category</th>
                    <th>Price</th>
                    <th>Discount (%)</th>
                    <th>Discount Price</th>
                    <th>Status</th>
                    <th>Stock</th>
                    <th>Action</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="p, c : ${products}">
                    <td>[[${c.count}]]</td>
                    <td><img th:src="@{'/img/product_img/' + ${p.image}}" class="product-img" alt="Product Image"></td>
                    <td>[[${p.title}]]</td>
                    <td>[[${p.category}]]</td>
                    <td>₹[[${p.price}]]</td>
                    <td>[[${p.discount}]]%</td>
                    <td>₹[[${p.discountPrice}]]</td>
                    <td>
                        <span th:classappend="${p.isActive} ? 'badge bg-success' : 'badge bg-secondary'" 
                              th:text="${p.isActive} ? 'Active' : 'Inactive'">
                        </span>
                    </td>
                    <td>[[${p.stock}]]</td>
                    <td>
                        <a th:href="@{'/admin/editProduct/' + ${p.id}}" class="btn btn-sm btn-outline-primary me-1">
                            <i class="fa-solid fa-pen-to-square"></i> Edit
                        </a>
                        <a th:href="@{'/admin/deleteProduct/' + ${p.id}}" class="btn btn-sm btn-outline-danger">
                            <i class="fa-solid fa-trash"></i> Delete
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Footer Info and Pagination -->
        <div class="row mt-3">
            <div class="col-md-4">
                <p class="fw-semibold">Total Products: [[${totalElements}]]</p>
            </div>
            <div class="col-md-8">
                <nav aria-label="Product page navigation">
                    <ul class="pagination justify-content-end">
                        <li class="page-item" th:classappend="${isFirst} ? 'disabled'">
                            <a class="page-link" th:href="@{'/admin/products?pageNo=' + ${pageNo - 1}}">
                                &laquo;
                            </a>
                        </li>
                        <li class="page-item"
                            th:each="i : ${#numbers.sequence(1, totalPages)}"
                            th:classappend="${pageNo + 1 == i} ? 'active'">
                            <a class="page-link" th:href="@{'/admin/products?pageNo=' + (${i - 1})}">
                                [[${i}]]
                            </a>
                        </li>
                        <li class="page-item" th:classappend="${isLast} ? 'disabled'">
                            <a class="page-link" th:href="@{'/admin/products?pageNo=' + ${pageNo + 1}}">
                                &raquo;
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

    </div>
</section>
</body>
</html>
